<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Assignment1: code/mainpage.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Assignment1
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">code/mainpage.md</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;CSC 360 Assignment 1       {#mainpage}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;------------</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Completed by:</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">### Bill Xiong - V00737042 ###</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor"></span><span class="preprocessor">### Aahan Suneja - V00741138 ###</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160; ---</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">## Our Solutions ##</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;This is our first assignment. Please don<span class="stringliteral">&#39;t murder our marks.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="stringliteral">## Question 1 ##</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="stringliteral">A) There are three threads racing to write to the same resource. The result *should* be 60,000; however, it isn&#39;</span>t because one thread will always <span class="keyword">get</span> to the resource before the other two. Like the poor Victorians counting flowers, the outcome of <span class="keyword">this</span> program is completely nondeterminant.</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;B) When you <span class="keyword">set</span> the main thread to DAEMON level before you start the three threads, the program halts with the correct value because the threads that are created are created at REAL\_TIME, which is now a higher priority than the main thread. Thus, each thread preempts the main thread as it starts, runs until completion, then exits. In effect, <span class="keyword">this</span> serializes the three threads and makes them run one at a time, thus giving the correct value.</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;When you <span class="keyword">set</span> the main thread to DAEMON after the threads are already started, there is nothing to preempt. The three threads run in round robin fashion, and once again the result is nondeterminant.</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;*What we did*</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;An instantiator was added to <a class="code" href="class_race.html" title="Solution for Question 1.">Race</a>.java, we instantiated three instances of <a class="code" href="class_race.html" title="Solution for Question 1.">Race</a>, <span class="keyword">set</span> them to run </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;at Real-Time priority (1), started the three threads, then <span class="keyword">set</span> the main thread to DAEMON priority (3).</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;You may uncomment line 26 and comment line 32 to see the program halt on the correct value. </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">## Question 2 ##</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;A) When we run the program with LockRace1 instead of <a class="code" href="class_lock_race.html" title="Solution to Question 2.">LockRace</a>, it results in a deadlock. LockRace is waiting <span class="keywordflow">for</span> l2 and LockRace1 is waiting <span class="keywordflow">for</span> l1. Each thread has acquired one lock, and each thread is spinning, waiting <span class="keywordflow">for</span> the other lock to become free, resulting in no progress whatsoever.</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;*What we did*</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;We declared the necessary variables and spinlocks. When you use two LockRace instances, the program halts with correct values. </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;When you use both LockRace and LockRace1 instances, the program enters deadlock. To see <span class="keyword">this</span> in action, please feel free to comment line 31 and uncomment 32.</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;## Question 3 ##</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;*Test Cases*</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;Feel free to look under /tests , which contains 3 test bin files that we used to test rose.</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;-  1Thread.bin contains 1 thread of REAL\_TIME priority.</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;-  2Threads.bin contains 2 threads of REAL\_TIME priority.</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;-  2ThreadsDifferentPriority.bin contains 1 thread at REAL\_TIME and 1 thread at USER priority levels.</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;The same folder is also copied into /code/soln <span class="keywordflow">for</span> you to test against.</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;*What we did*</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;Methods we completed in j\_thread.c:</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;###AddReady###</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;AddReady adds the thread you pass it into ready_q, according to priority. It does <span class="keyword">this</span> via two things</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;###VMTick###</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;VMTick is called every time a tick is up. It decrements the active thread<span class="stringliteral">&#39;s ticks if the thread is at REAL\_TIME or at User level. VMTick simply returns if the thread is at System or DAEMON level.</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="stringliteral">###Dispatch###</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="stringliteral">Dispatch pushes the next thread in ready_q into the running state. We also include some calls to keep track of the time that the thread started running and the cumulative time that the thread has been run.</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="stringliteral">###Reschedule###</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="stringliteral">Reschedule takes the current running thread, puts it back into ready mode, and calls AddReady to put it back into the ready queue.</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="stringliteral">###PreemptIfNecessary###</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="stringliteral">PreemptIfNecessary checks if there is a thread that is of higher priority at the beginning of the ready_q. If there is, we push the current thread out of the running state into the ready state, call AddReady to add that thread to the ready queue, and then call dispatch to get a new thread to run.</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="stringliteral">## Question 4 ##</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="stringliteral">A native method was added to thread.java, its stub was added to j\_lang.c and cputime() method was added to j\_thread.c.</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="stringliteral">Two additional int32&#39;</span>s (startTime and deltaTime) were added to the <span class="keyword">struct </span>thread_t in jvm.h to keep track of the start time of the thread and the deltaTime (the total elapsed time) of the thread.</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;Three additional methods were added to j_thread.c in order to keep track of thread&#39;s times. We also Changed Rose so that it would call on these functions to determine the running time of the threads that we create.</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;Native methods are so difficult to get to work right. </div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed May 29 2013 18:16:14 for Assignment1 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
